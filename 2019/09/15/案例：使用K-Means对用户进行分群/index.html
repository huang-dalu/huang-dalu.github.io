<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">
<meta name="referrer" content="same-origin">
<meta name="referrer" content="no-referrer">

<meta name="description" content="案例：使用K-Means对用户进行分群"/><meta name="keywords" content="机器学习, UX Caff" /><link rel="alternate" href="/atom.xml" title="UX Caff" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="http://example.com/2019/09/15/案例：使用K-Means对用户进行分群/"/>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<script>
  window.config = {"toc":true,"fancybox":false,"pjax":false,"latex":true};
</script>

    <title>案例：使用K-Means对用户进行分群 - UX Caff</title>
  <meta name="generator" content="Hexo 5.2.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">UX Caff</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/about">
        <li class="mobile-menu-item">About
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="" class="logo">UX Caff</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about">
            About
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">案例：使用K-Means对用户进行分群
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-09-15
        </span></div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#K-Means%E5%AE%9A%E4%B9%89"><span class="toc-text">K-Means定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA"><span class="toc-text">案例演示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0%E6%80%A7%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90"><span class="toc-text">描述性统计分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B4%E4%BD%93%E6%95%B0%E6%8D%AE%E6%8F%8F%E8%BF%B0%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-text">查看整体数据描述性分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8D%95%E4%B8%AA%E4%B8%BB%E4%BD%93%E5%8F%98%E9%87%8F%E4%BC%9A%E5%91%98%E9%80%90%E5%B9%B4%E5%A2%9E%E9%95%BF%E6%83%85%E5%86%B5"><span class="toc-text">查看单个主体变量会员逐年增长情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8D%95%E4%B8%AA%E5%88%86%E7%B1%BB%E5%9E%8B%E5%8F%98%E9%87%8F%E6%AF%94%E4%BE%8B%E5%8F%98%E5%8C%96%E6%83%85%E5%86%B5%EF%BC%88%E7%9B%B4%E6%96%B9%E5%A0%86%E7%A7%AF%E5%9B%BE%EF%BC%89"><span class="toc-text">查看单个分类型变量比例变化情况（直方堆积图）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8D%95%E4%B8%AA%E5%88%86%E7%B1%BB%E5%9E%8B%E5%8F%98%E9%87%8F%E5%8D%A0%E6%AF%94%E6%83%85%E5%86%B5%EF%BC%88%E7%9B%B4%E6%96%B9%E5%9B%BE-amp-%E9%A5%BC%E5%9B%BE%EF%BC%89"><span class="toc-text">查看单个分类型变量占比情况（直方图&amp;饼图）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8D%95%E4%B8%AA%E5%88%86%E7%B1%BB%E5%9E%8B%E5%8F%98%E9%87%8F%E9%A2%91%E6%95%B0%E6%83%85%E5%86%B5%EF%BC%88%E7%9B%B4%E6%96%B9%E5%9B%BE%EF%BC%89"><span class="toc-text">查看单个分类型变量频数情况（直方图）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8D%95%E4%B8%AA%E6%95%B0%E5%80%BC%E5%9E%8B%E5%8F%98%E9%87%8F%E5%88%86%E5%B8%83%E6%83%85%E5%86%B5%EF%BC%88%E7%AE%B1%E5%9E%8B%E5%9B%BE%EF%BC%89"><span class="toc-text">查看单个数值型变量分布情况（箱型图）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-text">相关性分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-text">数据预处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97"><span class="toc-text">数据清洗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E5%BD%92%E7%BA%A6"><span class="toc-text">属性归约</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96"><span class="toc-text">数据标准化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90"><span class="toc-text">聚类分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90%E5%8F%AF%E8%A7%86%E5%8C%96%EF%BC%88%E9%9B%B7%E8%BE%BE%E5%9B%BE%EF%BC%89"><span class="toc-text">聚类分析可视化（雷达图）</span></a></li></ol></li></ol></li></ol>
    </div>
  </div><div class="post-content"><p>本篇主要通过一个案例，来演示K-Means的用法。<a id="more"></a></p>
<h2 id="K-Means定义"><a href="#K-Means定义" class="headerlink" title="K-Means定义"></a>K-Means定义</h2><p>K-Means 算法是聚类算法的一种，所以先了解聚类算法。</p>
<p>聚类分析是在没有给定划分类别情况下，根据数据相似度进行样本分组的一种方法。是一种无监督的学习算法。划分依据主要是自身的距离或相似度将他们划分为若干组，划分原则是组内样本最小化而组间（外部）距离最大化。聚类多数场景下用在「数据探索」环节，也就是用来了解数据。它无法提供明确的行动指向，更多是为后期挖掘和分析提供参考，无法回答“为什么”和“怎么办”的问题。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609659951674-70225e26-52a2-43b6-8d45-42f4831a13ef.png#align=left&display=inline&height=170&margin=%5Bobject%20Object%5D&name=image.png&originHeight=340&originWidth=604&size=76903&status=done&style=none&width=302" alt="image.png"></p>
<p>聚类分析和分类区别：分类是从特定的数据中挖掘模式，作出分类判断；聚类是根据数据本身特点，按照不同的模型来判断数据之间的相似性、相似性高的一组数据聚成一簇。</p>
<p>K-Means 算法是基于距离的聚类方法，在最小误差函数的基础上将数据划分为预定的类数 K，采用距离作为相似性的评价指标，认为两个对象的距离越近，其相似度越高。适用于连续型数据。使用场景可以是：用户分群分析。</p>
<p><strong>算法过程</strong></p>
<ol>
<li>从 n 个样本数据中随机选取 K 个对象作为初始的聚类中心（在一开始确定 K 值上，凭业务经验划分，所以K值的选定不一定合理）；</li>
<li>分别计算每个样本到各个聚类中心的距离，将对象分配到距离最近的聚类中；</li>
<li>所有对象分配完成后，重新计算 K 个聚类的中心（类似重新计算虚拟中心）；</li>
<li>与前一次计算得到的 K 个聚类中心比较，如果聚类中心发生变化，转至步骤 2，否则转至步骤 5；</li>
<li>当质心不发生变化时，停止并输出聚类结果；</li>
<li>度量距离：度量样本之间的相似性最常用的是欧几里得距离、曼哈顿距离和闵可夫斯基距离（Python 中目前支持欧氏距离）。</li>
</ol>
<p><strong>伪代码如图所示</strong><br><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609660150949-6815cd42-d6c5-4416-ba91-6f4216872145.png#align=left&display=inline&height=419&margin=%5Bobject%20Object%5D&name=image.png&originHeight=838&originWidth=1222&size=296416&status=done&style=none&width=611" alt="image.png"></p>
<h2 id="案例演示"><a href="#案例演示" class="headerlink" title="案例演示"></a>案例演示</h2><p><em>注：以下案例数据集来源于《Python数据分析与挖掘实战（第2版）》，但是整体分析流程有调整。可以互相查阅学习。</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib inline</span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.family&#x27;</span>] = [<span class="string">&#x27;Arial Unicode MS&#x27;</span>] </span><br><span class="line">pd.set_option(<span class="string">&#x27;display.max_columns&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="comment"># sns.set_style(&quot;darkgrid&quot;,&#123;&quot;font.sans-serif&quot;:[&#x27;simhei&#x27;,&#x27;Droid Sans Fallback&#x27;]&#125;)</span></span><br><span class="line"></span><br><span class="line">os.chdir(<span class="string">&#x27;/data&#x27;</span>)</span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;air_data.csv&#x27;</span>)</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609660644766-82bb23ff-4050-4aed-9058-32cd2dd70a71.png#align=left&display=inline&height=170&margin=%5Bobject%20Object%5D&name=image.png&originHeight=340&originWidth=1994&size=77310&status=done&style=none&width=997" alt="image.png"><br>部分数据字段</p>
<h3 id="描述性统计分析"><a href="#描述性统计分析" class="headerlink" title="描述性统计分析"></a>描述性统计分析</h3><h4 id="查看整体数据描述性分析"><a href="#查看整体数据描述性分析" class="headerlink" title="查看整体数据描述性分析"></a>查看整体数据描述性分析</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explore = df.describe(percentiles=[], include=<span class="string">&#x27;all&#x27;</span>).T</span><br><span class="line">explore</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609661223161-19fa1a93-4625-4a9b-9d29-235554837da5.png#align=left&display=inline&height=602&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1204&originWidth=1326&size=197420&status=done&style=none&width=663" alt="image.png"><br>部分数据字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">explore[<span class="string">&#x27;null&#x27;</span>] = <span class="built_in">len</span>(df) - explore[<span class="string">&#x27;count&#x27;</span>]</span><br><span class="line">df_check = explore[[<span class="string">&#x27;null&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>]]</span><br><span class="line">df_check.columns = [[<span class="string">&#x27;空值记录数&#x27;</span>, <span class="string">&#x27;最大值&#x27;</span>, <span class="string">&#x27;最小值&#x27;</span>]]</span><br><span class="line">df_check</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609661301809-df8b9384-93d1-4354-ac93-4284040720e0.png#align=left&display=inline&height=564&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1128&originWidth=688&size=96763&status=done&style=none&width=344" alt="image.png"><br>部分数据字段</p>
<h4 id="查看单个主体变量会员逐年增长情况"><a href="#查看单个主体变量会员逐年增长情况" class="headerlink" title="查看单个主体变量会员逐年增长情况"></a>查看单个主体变量会员逐年增长情况</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">&#x27;FFP_DATE_year&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;FFP_DATE&#x27;</span>]).dt.year</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取每个年份的合计数量。方式一</span></span><br><span class="line">count = df[<span class="string">&#x27;FFP_DATE_year&#x27;</span>].value_counts(sort=<span class="literal">False</span>).reset_index()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取每个年份的合计数量。方式二</span></span><br><span class="line"><span class="comment"># count = df.groupby(&#x27;FFP_DATE&#x27;)[&#x27;FFP_DATE&#x27;].count()</span></span><br><span class="line"></span><br><span class="line">count.columns = [<span class="string">&#x27;入会时间&#x27;</span>, <span class="string">&#x27;入会人数&#x27;</span>]</span><br><span class="line">count.plot(kind=<span class="string">&#x27;bar&#x27;</span>, x=<span class="string">&#x27;入会时间&#x27;</span>, y=<span class="string">&#x27;入会人数&#x27;</span>, figsize=(<span class="number">12</span>,<span class="number">8</span>))</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609661365172-ec92e7b0-3903-484a-9113-4e067c2512b0.png#align=left&display=inline&height=369&margin=%5Bobject%20Object%5D&name=output_8_1.png&originHeight=492&originWidth=719&size=9707&status=done&style=none&width=539" alt="output_8_1.png"></p>
<h4 id="查看单个分类型变量比例变化情况（直方堆积图）"><a href="#查看单个分类型变量比例变化情况（直方堆积图）" class="headerlink" title="查看单个分类型变量比例变化情况（直方堆积图）"></a>查看单个分类型变量比例变化情况（直方堆积图）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用数据交叉表，计算每个年度时间节点，出现男女分类的数量情况</span></span><br><span class="line">cross_table = pd.crosstab(index=df[<span class="string">&#x27;FFP_DATE_year&#x27;</span>],columns=df[<span class="string">&#x27;GENDER&#x27;</span>])</span><br><span class="line">cross_table</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609663099981-b568a5b0-16b2-4784-bb73-0d257337dad4.png#align=left&display=inline&height=320&margin=%5Bobject%20Object%5D&name=image.png&originHeight=640&originWidth=384&size=40027&status=done&style=none&width=192" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过div函数，让分组每行合计等于1，用来看每个分组占比</span></span><br><span class="line">cross_table = cross_table.div(cross_table.<span class="built_in">sum</span>(<span class="number">1</span>), axis=<span class="number">0</span>)</span><br><span class="line">cross_table</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609663126719-d9b274e0-4ef7-48c0-a775-5643d0f5a1b9.png#align=left&display=inline&height=324&margin=%5Bobject%20Object%5D&name=image.png&originHeight=648&originWidth=466&size=53806&status=done&style=none&width=233" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cross_table.plot(kind=<span class="string">&#x27;bar&#x27;</span>, stacked=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609661406389-87534c6b-7221-4eae-b0b6-1076bce88eec.png#align=left&display=inline&height=274&margin=%5Bobject%20Object%5D&name=output_12_1.png&originHeight=274&originWidth=370&size=6785&status=done&style=none&width=370" alt="output_12_1.png"></p>
<h4 id="查看单个分类型变量占比情况（直方图-amp-饼图）"><a href="#查看单个分类型变量占比情况（直方图-amp-饼图）" class="headerlink" title="查看单个分类型变量占比情况（直方图&amp;饼图）"></a>查看单个分类型变量占比情况（直方图&amp;饼图）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 男女分别数量合计占比</span></span><br><span class="line">sns.countplot(x=<span class="string">&#x27;GENDER&#x27;</span>,data=df)</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609663209770-658345ad-aeb2-49cf-b5eb-6f296a014350.png#align=left&display=inline&height=262&margin=%5Bobject%20Object%5D&name=output_14_1.png&originHeight=262&originWidth=397&size=4806&status=done&style=none&width=397" alt="output_14_1.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 男女会员分别所有数量。方式一</span></span><br><span class="line"><span class="comment"># male_count = df.groupby(&#x27;GENDER&#x27;)[&#x27;GENDER&#x27;].count()[0]</span></span><br><span class="line"><span class="comment"># female_count = df.groupby(&#x27;GENDER&#x27;)[&#x27;GENDER&#x27;].count()[1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line">male_count = pd.value_counts(df[<span class="string">&#x27;GENDER&#x27;</span>])[<span class="string">&#x27;男&#x27;</span>]</span><br><span class="line">female_count = pd.value_counts(df[<span class="string">&#x27;GENDER&#x27;</span>])[<span class="string">&#x27;女&#x27;</span>]</span><br><span class="line"></span><br><span class="line">plt.pie([male_count, female_count], </span><br><span class="line">        labels=[<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>], </span><br><span class="line">        colors=[<span class="string">&#x27;lightskyblue&#x27;</span>, <span class="string">&#x27;lightcoral&#x27;</span>],</span><br><span class="line">        autopct=<span class="string">&#x27;%1.1f%%&#x27;</span>,</span><br><span class="line">       )</span><br><span class="line">plt.show</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609663251250-cb9db598-ddeb-4c07-8ad5-3e306287b905.png#align=left&display=inline&height=231&margin=%5Bobject%20Object%5D&name=output_15_1.png&originHeight=231&originWidth=231&size=6109&status=done&style=none&width=231" alt="output_15_1.png"></p>
<h4 id="查看单个分类型变量频数情况（直方图）"><a href="#查看单个分类型变量频数情况（直方图）" class="headerlink" title="查看单个分类型变量频数情况（直方图）"></a>查看单个分类型变量频数情况（直方图）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式一： 直接使用sns.countplot 查看单个变量的分类情况</span></span><br><span class="line"><span class="comment"># sns.countplot(x=&#x27;FFP_TIER&#x27;,data=df)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二：</span></span><br><span class="line">FFP_TIER_Level4 = pd.value_counts(df[<span class="string">&#x27;FFP_TIER&#x27;</span>])[<span class="number">4</span>]</span><br><span class="line">FFP_TIER_Level5 = pd.value_counts(df[<span class="string">&#x27;FFP_TIER&#x27;</span>])[<span class="number">5</span>]</span><br><span class="line">FFP_TIER_Level6 = pd.value_counts(df[<span class="string">&#x27;FFP_TIER&#x27;</span>])[<span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">plt.bar(x=<span class="built_in">range</span>(<span class="number">3</span>), </span><br><span class="line">        height=[FFP_TIER_Level4, FFP_TIER_Level5, FFP_TIER_Level6],</span><br><span class="line">        width=<span class="number">0.4</span>,</span><br><span class="line">        alpha=<span class="number">0.8</span>,</span><br><span class="line">        color=<span class="string">&#x27;skyblue&#x27;</span>)</span><br><span class="line">plt.xticks([index <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609663278899-bcc8c0f9-4b9a-4a55-96ea-2df8a35aa71d.png#align=left&display=inline&height=247&margin=%5Bobject%20Object%5D&name=output_17_0.png&originHeight=247&originWidth=384&size=4299&status=done&style=none&width=384" alt="output_17_0.png"></p>
<h4 id="查看单个数值型变量分布情况（箱型图）"><a href="#查看单个数值型变量分布情况（箱型图）" class="headerlink" title="查看单个数值型变量分布情况（箱型图）"></a>查看单个数值型变量分布情况（箱型图）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 会员年龄分布箱型图</span></span><br><span class="line"></span><br><span class="line">plt.figaspect</span><br><span class="line">plt.boxplot(df[<span class="string">&#x27;AGE&#x27;</span>].dropna(),</span><br><span class="line">           patch_artist=<span class="literal">True</span>,</span><br><span class="line">           vert=<span class="literal">False</span>,</span><br><span class="line">           boxprops = &#123;<span class="string">&#x27;facecolor&#x27;</span>: <span class="string">&#x27;lightblue&#x27;</span>&#125;,</span><br><span class="line">           labels=[<span class="string">&#x27;会员年龄&#x27;</span>])</span><br><span class="line">plt.grid(linestyle=<span class="string">&quot;:&quot;</span>, color=<span class="string">&quot;r&quot;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;会员年龄分布箱型图&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609663303954-49193676-ac2f-49c5-ba15-c7ddf298741d.png#align=left&display=inline&height=263&margin=%5Bobject%20Object%5D&name=output_19_0.png&originHeight=263&originWidth=396&size=8550&status=done&style=none&width=396" alt="output_19_0.png"></p>
<h3 id="相关性分析"><a href="#相关性分析" class="headerlink" title="相关性分析"></a>相关性分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x27;FFP_TIER&#x27;,&#x27;FLIGHT_COUNT&#x27;,&#x27;LAST_TO_END&#x27;,&#x27;SEG_KM_SUM&#x27;,&#x27;EXCHANGE_COUNT&#x27;,&#x27;Points_Sum&#x27;,&#x27;FFP_DATE&#x27;的相关系数分析</span></span><br><span class="line">df_corr = df.loc[:, [<span class="string">&#x27;FFP_TIER&#x27;</span>,<span class="string">&#x27;FLIGHT_COUNT&#x27;</span>,<span class="string">&#x27;LAST_TO_END&#x27;</span>,<span class="string">&#x27;SEG_KM_SUM&#x27;</span>,<span class="string">&#x27;EXCHANGE_COUNT&#x27;</span>,<span class="string">&#x27;Points_Sum&#x27;</span>,<span class="string">&#x27;FFP_DATE&#x27;</span>]]</span><br><span class="line">age1 = df[<span class="string">&#x27;AGE&#x27;</span>].fillna(<span class="number">0</span>)</span><br><span class="line">df_corr[<span class="string">&#x27;AGE&#x27;</span>] = age1.astype(<span class="string">&#x27;int64&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># df的相关系数</span></span><br><span class="line">df_corr = df_corr.corr()</span><br><span class="line">df_corr</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609663343456-3ef0fbda-f30e-416e-a754-882395249549.png#align=left&display=inline&height=218&margin=%5Bobject%20Object%5D&name=image.png&originHeight=436&originWidth=1558&size=87945&status=done&style=none&width=779" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置图形大小</span></span><br><span class="line">plt.subplots(figsize=(<span class="number">10</span>,<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特征数据热力图</span></span><br><span class="line">ax = sns.heatmap(df_corr, annot=<span class="literal">True</span>, cmap=<span class="string">&#x27;Blues&#x27;</span>)</span><br><span class="line">ax.set_ylim([<span class="number">8</span>, <span class="number">0</span>])</span><br><span class="line">ax</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609663476591-02ec9a92-5ca3-4717-a2ca-4f393e27abd3.png#align=left&display=inline&height=664&margin=%5Bobject%20Object%5D&name=output_22_1.png&originHeight=664&originWidth=646&size=34967&status=done&style=none&width=646" alt="output_22_1.png"></p>
<h3 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h3><h4 id="数据清洗"><a href="#数据清洗" class="headerlink" title="数据清洗"></a>数据清洗</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 去除票价为空的行　</span></span><br><span class="line">airline_notnull = df.loc[df[<span class="string">&#x27;SUM_YR_1&#x27;</span>].notnull() &amp; df[<span class="string">&#x27;SUM_YR_2&#x27;</span>].notnull(), :]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保留票价非零数据，或者平均折扣率不为零且总飞行数大于0的记录；AGE去除大于100的记录</span></span><br><span class="line">index1 = airline_notnull[<span class="string">&#x27;SUM_YR_1&#x27;</span>] != <span class="number">0</span></span><br><span class="line">index2 = airline_notnull[<span class="string">&#x27;SUM_YR_2&#x27;</span>] != <span class="number">0</span></span><br><span class="line">index3 = (airline_notnull[<span class="string">&#x27;SEG_KM_SUM&#x27;</span>] &gt; <span class="number">0</span>) &amp; (airline_notnull[<span class="string">&#x27;avg_discount&#x27;</span>] != <span class="number">0</span>)</span><br><span class="line">index4 = airline_notnull[<span class="string">&#x27;AGE&#x27;</span>] &gt; <span class="number">100</span></span><br><span class="line">airline = airline_notnull[(index1 | index2) &amp; index3 &amp; ~index4]</span><br><span class="line">airline.head()</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609663521750-c16a7577-0629-45b0-8209-cb4e3571d02b.png#align=left&display=inline&height=174&margin=%5Bobject%20Object%5D&name=image.png&originHeight=348&originWidth=1984&size=77337&status=done&style=none&width=992" alt="image.png"><br>部分数据字段</p>
<h4 id="属性归约"><a href="#属性归约" class="headerlink" title="属性归约"></a>属性归约</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">airline = airline[[<span class="string">&#x27;FFP_DATE&#x27;</span>, <span class="string">&#x27;LOAD_TIME&#x27;</span>, <span class="string">&#x27;LAST_TO_END&#x27;</span>,<span class="string">&#x27;FLIGHT_COUNT&#x27;</span>,<span class="string">&#x27;SEG_KM_SUM&#x27;</span>,<span class="string">&#x27;avg_discount&#x27;</span> ]]</span><br><span class="line">airline[<span class="string">&#x27;FFP_DATE&#x27;</span>], airline[<span class="string">&#x27;LOAD_TIME&#x27;</span>] = pd.to_datetime(airline[<span class="string">&#x27;FFP_DATE&#x27;</span>]), pd.to_datetime(airline[<span class="string">&#x27;LOAD_TIME&#x27;</span>])</span><br><span class="line">airline[<span class="string">&#x27;L&#x27;</span>] = (airline[<span class="string">&#x27;LOAD_TIME&#x27;</span>] - airline[<span class="string">&#x27;FFP_DATE&#x27;</span>]).dt.days</span><br><span class="line">airline = airline.drop([<span class="string">&#x27;FFP_DATE&#x27;</span>, <span class="string">&#x27;LOAD_TIME&#x27;</span>], axis=<span class="number">1</span>)</span><br><span class="line">airline.columns = [<span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;L&#x27;</span>]</span><br><span class="line">airline.head()</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609663568332-70ae8162-8bf1-46ab-87fe-2d21a365d463.png#align=left&display=inline&height=159&margin=%5Bobject%20Object%5D&name=image.png&originHeight=318&originWidth=474&size=28174&status=done&style=none&width=237" alt="image.png"></p>
<h4 id="数据标准化"><a href="#数据标准化" class="headerlink" title="数据标准化"></a>数据标准化</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line">data = StandardScaler().fit_transform(airline)</span><br><span class="line">data[:<span class="number">5</span>, :]</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">array([[-0.94493902, 14.03402401, 26.76115699,  1.29554188,  1.43579256],</span><br><span class="line">       [-0.91188564,  9.07321595, 13.12686436,  2.86817777,  1.30723219],</span><br><span class="line">       [-0.88985006,  8.71887252, 12.65348144,  2.88095186,  1.32846234],</span><br><span class="line">       [-0.41608504,  0.78157962, 12.54062193,  1.99471546,  0.65853304],</span><br><span class="line">       [-0.92290343,  9.92364019, 13.89873597,  1.34433641,  0.3860794 ]])</span><br></pre></td></tr></table></figure>


<h3 id="聚类分析"><a href="#聚类分析" class="headerlink" title="聚类分析"></a>聚类分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> KMeans</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建模型,随机种子设为123</span></span><br><span class="line">kmeans_model = KMeans(n_clusters=<span class="number">5</span>, n_jobs=<span class="number">4</span>, random_state=<span class="number">123</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型训练</span></span><br><span class="line">fit_kmeans = kmeans_model.fit(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看聚类结果</span></span><br><span class="line">kmeans_cc = kmeans_model.cluster_centers_</span><br><span class="line">kmeans_cc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 样本的类别标签</span></span><br><span class="line">kmeans_lable = kmeans_model.labels_</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计不同类别样本数目</span></span><br><span class="line">pd.Series(kmeans_model.labels_).value_counts()</span><br><span class="line"></span><br><span class="line">cluster_center = pd.DataFrame(kmeans_model.cluster_centers_, columns=[<span class="string">&#x27;ZR&#x27;</span>,<span class="string">&#x27;ZF&#x27;</span>,<span class="string">&#x27;ZM&#x27;</span>,<span class="string">&#x27;ZC&#x27;</span>,<span class="string">&#x27;ZL&#x27;</span>])</span><br><span class="line"><span class="comment"># cluster_center.index = pd.DataFrame(kmeans_model.labels_).drop_duplicates().iloc[:,0]</span></span><br><span class="line">cluster_center</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609663621550-c9bfed73-777d-44c0-8ea1-62bda468d0d0.png#align=left&display=inline&height=164&margin=%5Bobject%20Object%5D&name=image.png&originHeight=328&originWidth=718&size=37057&status=done&style=none&width=359" alt="image.png"></p>
<h4 id="聚类分析可视化（雷达图）"><a href="#聚类分析可视化（雷达图）" class="headerlink" title="聚类分析可视化（雷达图）"></a>聚类分析可视化（雷达图）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#标签</span></span><br><span class="line">labels = cluster_center.columns </span><br><span class="line"></span><br><span class="line"><span class="comment">#数据个数</span></span><br><span class="line">k = <span class="number">5</span> </span><br><span class="line">plot_data = kmeans_model.cluster_centers_</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定颜色</span></span><br><span class="line">color = [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;y&#x27;</span>] </span><br><span class="line"></span><br><span class="line">angles = np.linspace(<span class="number">0</span>, <span class="number">2</span>*np.pi, k, endpoint=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 闭合</span></span><br><span class="line">plot_data = np.concatenate((plot_data, plot_data[:,[<span class="number">0</span>]]), axis=<span class="number">1</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 闭合</span></span><br><span class="line">angles = np.concatenate((angles, [angles[<span class="number">0</span>]])) </span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">8</span>,<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#polar参数</span></span><br><span class="line">ax = fig.add_subplot(<span class="number">111</span>, polar=<span class="literal">True</span>) </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plot_data)):</span><br><span class="line">  ax.plot(angles, plot_data[i], <span class="string">&#x27;o-&#x27;</span>, color = color[i], label = <span class="string">u&#x27;客户群&#x27;</span>+<span class="built_in">str</span>(i), linewidth=<span class="number">2</span>)<span class="comment"># 画线</span></span><br><span class="line"></span><br><span class="line">ax.set_rgrids(np.arange(<span class="number">0.01</span>, <span class="number">3.5</span>, <span class="number">0.5</span>), np.arange(-<span class="number">1</span>, <span class="number">2.5</span>, <span class="number">0.5</span>), fontproperties=<span class="string">&quot;SimHei&quot;</span>)</span><br><span class="line">ax.set_thetagrids(angles * <span class="number">180</span>/np.pi, labels, fontproperties=<span class="string">&quot;SimHei&quot;</span>)</span><br><span class="line">plt.legend(loc = <span class="number">4</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2021/png/613759/1609663646263-b9932bdd-996e-4b21-b064-cbc4d05a57bb.png#align=left&display=inline&height=271&margin=%5Bobject%20Object%5D&name=output_32_1.png&originHeight=361&originWidth=361&size=62814&status=done&style=none&width=271" alt="output_32_1.png"></p>

      </div>
      
      <footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a>
            </div>
        
        <nav class="post-nav"><a class="prev" href="/2019/09/17/%E5%A6%82%E4%BD%95%E5%81%9A%E5%A5%BD%E4%B8%80%E4%B8%AA%E5%88%86%E4%BA%AB%E8%80%85/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">如何做好一个分享者</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    <a class="next" href="/2019/09/10/%E5%A6%82%E4%BD%95%E5%BA%94%E5%AF%B9%E7%94%B5%E5%95%86%E5%A4%A7%E4%BF%83/">
        <span class="next-text nav-default">如何应对电商大促</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments">
      <div id="vcomments"></div>
    </div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:huangdalu@yeah.net" class="iconfont icon-email" title="email"></a>
        <a target="_blank" rel="noopener" href="https://github.com/huang-dalu" class="iconfont icon-github" title="github"></a>
        <a target="_blank" rel="noopener" href="https://www.douban.com/people/108055759" class="iconfont icon-douban" title="douban"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss" target="_blank"></a>
    </div><div class="copyright"><span class="division">&nbsp;</span><span class="copyright-year">Since 2020
      <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">huangdalu</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
<script src="./lib/valine/av-min.js?v=3.0.4"></script>
<script src='./lib/valine/Valine.min.js'></script>
<script type="text/javascript">
    new Valine({
        el: '#vcomments',
        notify: false,
        verify: false,
        app_id: "XtxvAXPwOzM9noIc3eyxi3AS-gzGzoHsz",
        app_key: "yEVQszyxb4bwLuAGU5VHnPR8",
        placeholder: "说点什么吧...",
        avatar: 'mm',
        visitor: 'ture'
    });
</script><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
